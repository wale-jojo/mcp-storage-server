// test-identity.js
const { spawn } = require('child_process');

const mcp = spawn('node', ['dist/index.js'], {
  env: {
    ...process.env,
    MCP_TRANSPORT_MODE: 'stdio',
    PRIVATE_KEY: 'MgCanjwXcoqhoDXqhcRWLV0B6A25qtLKecfqQNNDB0LnFPO0BCUCawk49jDVQSagUwdVm+zJ73wMhw9HU/9odiINp4PY=',
    DELEGATION: 'mAYIEAMsdEaJlcm9vdHOAZ3ZlcnNpb24B1QYBcRIgWK0xlJGCVtv7Cx6JXpuCYt78QHZBLMkKZDgQOQiEgmeoYXNYRO2hA0BwbujcrLEwRKmjbAHZZlXLvXeyqfMu6C2Xdhkq2oQPDt8HstDJCmau9P3ghKwCdP0OkK+hehnCTMzl0aWBV4kJYXZlMC45LjFjYXR0iKJjY2FuZ3NwYWNlLypkd2l0aHg4ZGlkOmtleTp6Nk1rd0pBRHZSUnlQak5nVVlTemhuaXRHZ1pGaG92UlpxQkMyWXY3eXI0QWdnMk6iY2NhbmZibG9iLypkd2l0aHg4ZGlkOmtleTp6Nk1rd0pBRHZSUnlQak5nVVlTemhuaXRHZ1pGaG92UlpxQkMyWXY3eXI0QWdnMk6iY2NhbmdpbmRleC8qZHdpdGh4OGRpZDprZXk6ejZNa3dKQUR2UlJ5UGpOZ1VZU3pobml0R2daRmhvdlJacUJDMll2N3lyNEFnZzJOomNjYW5nc3RvcmUvKmR3aXRheDhkaWQ6a2V5Ono2TWt3SkFEdlJSeVBqTmdVWVN6aG5pdEdnWkZob3ZSWnFCQzJZdjd5cjRBZ2cyTqJjY2FuaHVwbG9hZC8qZHdpdGh4OGRpZDprZXk6ejZNa3dKQUR2UlJ5UGpOZ1VZU3pobml0R2daRmhvdlJacUJDMll2N3lyNEFnZzJOomNjYW5oYWNjZXNzLypkd2l0aHg4ZGlkOmtleTp6Nk1rd0pBRHZSUnlQak5nVVlTemhuaXRHZ1pGaG92UlpxQkMyWXY3eXI0QWdnMk6iY2NhbmpmaWxlY29pbi8qZHdpdGh4OGRpZDprZXk6ejZNa3dKQUR2UlJ5UGpOZ1VZU3pobml0R2daRmhvdlJacUJDMll2N3lyNEFnZzJOomNjYW5ndXNhZ2UvKmR3aXRheDhkaWQ6a2V5Ono2TWt3SkFEdlJSeVBqTmdVWVN6aG5pdEdnWkZob3ZSWnFCQzJZdjd5cjRBZ2cyTmNhdWRYIu0B9woGeSkdzMm7jj+isVV/pZnftiL1dlnKxrSbdnA8p21jZXhwGmpp1cFjZmN0gaFlc3BhY2WhZG5hbWVmbmV3YmVlY2lzc1gi7QH6Qd4dlFBw+NyRexEY+ePK9Vc1t5+FigP5NOCB6a1tk2NwcmaAugIBcRIg2Z/m56YZzyiZCDMqo0b4SFAgP8GBefrzEBqVussLEXGoYXNYRO2hA0DNXBMw4iBgngRcvocc+ZI2Hq8kCcqek72otCao9HflSGKXdFqrC4n1DXw4I4jNk6y/NmtdQAeUEoikRhxi7Q4EYXZlMC45LjFjYXR0gaJjY2FuYSpkd2l0aHg4ZGlkOmtleTp6Nk1raGEzVFZua0pEQ1FFUjRMWllVZXZYbmMyb0N5TjlZeEQ4QlF0a3NMVERpR2ljYXVkWB+dGm1haWx0bzpnbWFpbC5jb206d2FsZS5qb2pvMTIzY2V4cPZjZmN0gaFlc3BhY2WhZG5hbWVwIENyZWF0b3JMaW5rLkFEQWNpc3NYIu0BLk/ksduaQGOfyQbb3vksm+ZI+B2EpTyhyWMykJgQ67NjcHJmgLoCAXESIHr0Gyw1EleRU/c0Ye34Ihdmpc/5oGYECVsqFGH34vsMqGFzWETtoQNAROixpwrekh3/LL2pS844ZL9FNkCvAO023by09lEvmQ4vfdt7QTPSSw4uXQVYNhJOfUYKm+uzbFP2yYtC+YHYDGF2ZTAuOS4xY2F0dIGiY2NhbmEqZHdpdGh4OGRpZDprZXk6ejZNa2ZqM1BGckExMXNaMTdSdEh1TERCclFCY29NVFR5dnZYTFFneHQ1ZnY4czlFY2F1ZFgfnRptYWlsdG86Z21haWwuY29tOndhbGUuam9qbzEyM2NleHD2Y2ZjdIGhZXNwYWNloWRuYW1lcCBDcmVhdG9yTGluay5BREFjaXNzWCLtARLmqgKdXj9FSDzBLQSRSZapYp+tSfPN/BfLUtc5deWNY3ByZoDNAgFxEiCy/TRAmp5kRsFJ6+qDBNeq5F05M4ALKmZVnN1/oBJ78qhhc1hE7aEDQPgvjB8Q0Mr1e4EftEFZ3ry7sFrCTw1pgoncVX3nuPLPdT6Dhcb9rliRXqa/QkVDdmkdndvcrmFUG8yZAPpQ/wVhdmUwLjkuMWNhdHSBomNjYW5hKmR3aXRheDhkaWQ6a2V5Ono2TWtwbjdTMWJpWGNrWVhjRDV6RjE0azF0YmRrNUx1WVZYNUN6dEpvR2k4Y1FvVGNhdWRYH50abWFpbHRvOmdtYWlsLmNvbTp3YWxlLmpvam8xMjNjZXhw9mNmY3SBoWVzcGFjZaJkbmFtZW9hbm9uLWJsZXNzLXdhbGxmYWNjZXNzoWR0eXBlZnB1YmxpY2Npc3NYIu0BmWkqVh321m3p8sw9P3j0eTn53ELsK53YkzP3aAdfWgpjcHJmgLACAXESIJoOQ096Y6b97V2tieo7+W+NqW43Nd/VKK6/EAMU+O+5qGFzWETtoQNAFOrw+rSwC+XLqxIS0gPOX0l2GXUFduQ/dvZJfpg7YvQBHYmHfs3753tgYN4qhKJbs2nDd+eIqK1Ul0dygq8BAWF2ZTAuOS4xY2F0dIGiY2NhbmEqZHdpdGh4OGRpZDprZXk6ejZNa3dKQUR2UlJ5UGpOZ1VZU3pobml0R2daRmhvdlJacUJDMll2N3lyNEFnZzJOY2F1ZFgfnRptYWlsdG86Z21haWwuY29tOndhbGUuam9qbzEyM2NleHD2Y2ZjdIGhZXNwYWNloWRuYW1lZm5ld2JlZWNpc3NYIu0B+kHeHZRQcPjckXsRGPnjyvVXNbefhYoD+TTggemtbZNjcHJmgL0DAXESIGcZd9zXMXJ3BrHs4baPCR0DVJjoGi77PTkBvo/AovhmqGFzRICgAwBhdmUwLjkuMWNhdHSBomNjYW5hKmR3aXRoZnVjYW46KmNhdWRYIu0B9woGeSkdzMm7jj+isVV/pZnftiL1dlnKxrSbdnA8p21jZXhw9mNmY3SBom5hY2Nlc3MvY29uZmlybdgqWCUAAXESIMMRFuXCinRy1sGtI/HlYm/sPkFyL+h4Cl1PfzRK8Jk4bmFjY2Vzcy9yZXF1ZXN02CpYJQABcRIg7ZhqtQZf0wJARRgTHickuCMKJfpN8NCQcZeSff1hrTljaXNzWB+dGm1haWx0bzpnbWFpbC5jb206d2FsZS5qb2pvMTIzY2V4cPZjZmN0gaFlc3BhY2WhZG5hbWVwIENyZWF0b3JMaW5rLkFEQWNpc3NYIu0BLk/ksduaQGOfyQbb3vksm+ZI+B2EpTyhyWMykJgQ67NjcHJmgLo'
  }
});

mcp.stdout.on('data', (data) => {
  // 发送 identity 请求
  mcp.stdin.write(JSON.stringify({
    jsonrpc: "2.0",
    id: 1,
    method: "identity",
    params: {}
  }) + '\n');
  // 打印服务返回
  console.log('服务返回:', data.toString());
});

mcp.stderr.on('data', (data) => {
  console.error('服务错误:', data.toString());
});

mcp.on('close', (code) => {
  console.log(`MCP 服务进程退出，退出码: ${code}`);
});